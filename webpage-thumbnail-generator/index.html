<form>
  <input name="url" placeholder='"https://www.flex.io", etc.'>
  <button type="button">Submit</button>
</form>

<img id="img_result" src="" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flexio-sdk-js@1.19.0"></script>

<script>
  Flexio.setup('nmgzsqppgwqbvkfhjdjd')

  var doSubmit = function() {
    Flexio.pipe()
      .render({
        "url": "${form.url}",
        "format": "png", // 'png' or 'pdf'
        "width": 800,
        "height": 600,
        "scrollbars": false
      })
      .python(`
import PIL
from PIL import Image
from io import BytesIO

def flexio_handler(context):
    context.output.content_type = context.input.content_type

    imagedata = context.input.read()
    file_imagedata = BytesIO(imagedata)
    img = Image.open(file_imagedata)
    imgformat = img.format

    basewidth = 160
    wpercent = (basewidth / float(img.size[0]))
    hsize = int((float(img.size[1]) * float(wpercent)))
    img = img.resize((basewidth, hsize), PIL.Image.ANTIALIAS)

    file_output = BytesIO()
    img.save(file_output, format = imgformat)
    file_output.seek(0)
    contents = file_output.getvalue()
    file_output.close()

    context.output.write(contents)
`)
      .run({ data: $('form').serialize() })
      .then(function(response) {
        // response is an image blob
        var url_creator = window.URL || window.webkitURL
        $('#img_result').prop('src', url_creator.createObjectURL(response.blob))
      })
  }

  $('form').on('submit', function (evt) {
    evt.preventDefault()
    doSubmit()
  })

  $('button').click(function(evt) {
    doSubmit()
  })
</script>
