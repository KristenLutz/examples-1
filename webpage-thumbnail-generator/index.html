<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tachyons/4.6.1/tachyons.min.css" integrity="sha256-eu1dpzpUytdOAUmB67Qi3mBb6HFjruP8BoAzk4lKiSc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/css-spinning-spinners/1.1.1/load5.css">
    <style>
      .darken-10:hover,
      .darken-10:focus {
        box-shadow: inset 9999px 9999px rgba(0,0,0,0.10)
      }

      .darken-10:active {
        box-shadow: inset 9999px 9999px rgba(0,0,0,0.20)
      }
    </style>
  </head>

  <body>
    <a href="https://github.com/flexiodata/examples/tree/master/webpage-thumbnail-generator"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

    <div id="top"></div>

    <div id="app" class="flex flex-column tc">
      <div id="header" class="mt5 center tc" style="min-width: 700px">
        <div class="f3 ma0">Webpage Thumbnail Generator</div>
        <form class="mt3 mb2">
          <div class="f5 dib pr1">Enter URL:</div>
          <input id="input_url" class="input-reset ba b--black-20 pa2 f6 w5" style="width: 400px" name="url" placeholder='"https://www.flex.io", etc.' autocomplete=off spellcheck="false">
          <button type="button" class="btn-submit border-box no-select ba ttu b f6 ph3 pv2 br1 white bg-blue b--blue darken-10">Submit</button>
        </form>
      </div>
      <div class="flex-fill mt3 center">
        <img id="img_result" src="" />
      </div>
    </div>

    <footer class="fixed z-1 bottom-0 w-100 f6 bg-white tc" style="padding: 12px 10px 10px; box-shadow: inset 0 -20px 60px rgba(0,0,0,0.1), inset 0 1px 4px rgba(0,0,0,0.2)">
      <a href="https://www.flex.io" title="Visit Flex.io website" class="no-underline gray hover-black" target="_blank">
        <span class="relative" style="top: -1px; left: -2px">Powered by</span> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAAQCAYAAACycufIAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAARtSURBVHjatJd7iFR1FMfPnZndHXV2Uxexda10faybplYmKhkRZJZRWFZKVFAIay/ZiiARLFFRBO2dYKSbaBGGoeSqlKEV+cj6I4lVCnSVbSWHdXUfs7Mz9/Y94/eXx+Gu4qoHPszv3t+9v3tev3N+4w27ZYhQBoJFYAZIgD/BZvAJSIMnQCHYBAK5xpLt8KV8Wl8ZVT0oN6b0B0+BA+DQla4ZM7+q9H1m7m5SAWrBV04P8OW1Nk4iIqnTmXy3vQ+eBidAFWi7wiVzMsoYlgRrQB2vdzKqTobLdZBoYUSaD7fLv/vPSjTu1Lq6DHGr3GzuqWHzwEPgQbAdFJn5zPUwTjxY4gdydN0p6WhKSyTm6d3nwRw6vq2naVlg7jWa8Y4Ln+5W7gJPMm30ub/BN2C3BgS8Cm4EPvdvg3n3VvAMnXzMi3pr0ueyQVerL/EBuXlNyTIwlO+eMe9OAY+BkdRfU3cX68RFxiXMSyXgBqZEK5XqTuaDFXmRVXkZLAZvc403ef8O8IBx2EfgXl7PCjJBUDKil/QpL5TgfH5oBk3k/Bc0Th2xGrxE51mZSwOfA0364KfgA/PAAlAPfqfXuhNNl3dpWDvYStqo+CJGZS1Yz3emMZIqNcawJeBrvyuQARMSEktEJAhy262V823Gyau4RpQB0Cq6jzq4b2zRgKlxj4B+RuliplEFS3++ZJgGy0wB0r35KLkfNHPuDSqhv0d57x1QzagKy/ySAKoXlESl9PaE+OnQOqIGTjbOaeS3JvD+JNMudFzjjNtgFvkevEWFkiEf6QBTgWuQn4G9Zv4X7g+V27gnk0wV7Zd9OV9MJzwLOv20L/1G95bEkLhoBMNaIZ/1GLEa6urkDzDbRPvxGENawhRS+Q4sv1S/BZXm+mF6zjPlu9Tsq9H8hrKUkXPPvQ6O/L/ZK3qJB3ejsEiQvchAvYizeAidsitEt7/AYUau3BWUPuaB+GUqbJCXrlWXeb63GTeHZMH5Pofe1vBtUs4dT0lVdZlE0PeMgRrxTlO4MpdoSW7vRWM97I22XWxiahYZ450yxUwXlXFmn7qoakE6yPYh2c5Amva2SCH2XuXcMsleMC7gnvvHHMt0vZ/zdNPAjHC1INID43SBH0xuj+U+207qeC6t4PgkM6OWLSfJ1uDz5LPO9VlNyVgiKo27W6Slvl2iRRHPOMI3fVeD8l5eIRSm/U0c7+mJcUVUcC2vx9D783iSWMwKWMvICO+N41ir5EoqJyxONe5o53myB8Wl7uTO5lK0gy7zXXXQRvAbr++kU1exlWiteM2k/0qXlrYZFoQd/ULmF7BizuRJ4+OQllHPvuM+qkXgQ44XspSP4UFAs2E8uMfD0au1ITUJ/w4ykQIUFz+XLapDiv8StvE8XJlX3Jxh2oOPOONO0/sqx0KMs/Pu+JTi36D5PAYNZ6E5wwOAnuh/orcPcaO/mLfxX+E+1Pde4GFiv66Nivkrfj/nuVdbTYupiFPpsOlgMA0/BX7kGlox5T8BBgDZXj7KmAFAmQAAAABJRU5ErkJggg==">
      </a>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flexio-sdk-js@1.19.0"></script>

    <script>
      var setLoading = function(loading) {
        if (loading === false)
        {
          $('#top').removeClass('loading')
          $('.btn-submit').removeClass('o-40').text('Submit').removeAttr('disabled')
        }
         else
        {
          $("#img_result").empty()
          $('#top').addClass('loading')
          $('.btn-submit').addClass('o-40').text('Loading...').prop('disabled', 'true')
        }
      }

      var doSubmit = function() {
        var url = $('#input_url').val()
        if (url.indexOf('http') == -1)
        {
          alert('The URL entered is invalid. Enter a valid URL to continue.')
          return
        }

        setLoading(true)

        Flexio.setup('nmgzsqppgwqbvkfhjdjd')
        Flexio.pipe()
          // request the content of the URL that is specified and render it to PNG
          .render({
            url: '${form.url}',
            format: 'png', // 'png' or 'pdf'
            scrollbars: false
          })
          // this Python script resizes the image from the render call above.
          // The Python script interacts with the Flex.io pipe via the
          // `content.input.read()` and `content.output.write()` methods.
          // The Flex.io code handler `def flexio_handler(context):` is required.
          .python(`
import PIL
from PIL import Image
from io import BytesIO

def flexio_handler(context):
    context.output.content_type = context.input.content_type

    imagedata = context.input.read()
    file_imagedata = BytesIO(imagedata)
    img = Image.open(file_imagedata)
    imgformat = img.format

    basewidth = 160
    wpercent = (basewidth / float(img.size[0]))
    hsize = int((float(img.size[1]) * float(wpercent)))
    img = img.resize((basewidth, hsize), PIL.Image.ANTIALIAS)

    file_output = BytesIO()
    img.save(file_output, format = imgformat)
    file_output.seek(0)
    contents = file_output.getvalue()
    file_output.close()

    context.output.write(contents)
          `)
          .run({ data: $('form').serialize() })
          .then(function(response) {
            // response is an image blob
            var url_creator = window.URL || window.webkitURL
            $('#img_result').prop('src', url_creator.createObjectURL(response.blob))

            setLoading(false)
          })
      }

      $('form').on('submit', function (evt) {
        evt.preventDefault()
        doSubmit()
      })

      $('.btn-submit').click(function(evt) {
        doSubmit()
      })
    </script>
  </body>
</html>
