<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>StackExchange Posts by Language</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="Serverless chart of StackExchange Posts using Flex.io">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="twitter:title" content="StackExchange Posts by Language">
    <meta name="twitter:description" content="Serverless chart of StackExchange Posts using Flex.io">

    <meta property="og:title" content="StackExchange Posts by Language">
    <meta property="og:url" content="https://github.com/flexiodata/examples/tree/master/demo-chart-stack-exchange-posts">
    <meta property="og:description" content="Serverless chart of StackExchange Posts using Flex.io">

    <link rel="apple-touch-icon" href="https://s3.amazonaws.com/flexio-app-assets/apple-touch-icon.png">
    <link rel="icon" href="https://s3.amazonaws.com/flexio-app-assets/favicon.png">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tachyons/4.6.1/tachyons.min.css" integrity="sha256-eu1dpzpUytdOAUmB67Qi3mBb6HFjruP8BoAzk4lKiSc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/css-spinning-spinners/1.1.1/load5.css">

    <style>
      html, body {
        font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 100%;
      }

      html {
        height: 100%;
      }

      body {
        overflow: auto;
        position: relative;
      }

      button, input, optgroup, select, textarea {
        font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
      }

      /* Same as .flex-auto in Tachyons except without the 'auto' flex-basis */

      .flex-fill {
        -ms-flex: 1 1;
        flex: 1 1;
        min-width: 0;
        min-height: 0;
      }

      /* Button hover */

      .darken-10:hover,
      .darken-10:focus {
        box-shadow: inset 9999px 9999px rgba(0,0,0,0.10)
      }

      .darken-10:active {
        box-shadow: inset 9999px 9999px rgba(0,0,0,0.20)
      }
    </style>
  </head>
  <body>
    <a href="https://github.com/flexiodata/examples/tree/master/demo-chart-stack-exchange-posts"><img class="z-max" style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

    <div id="top"></div>

    <div id="app" class="flex flex-column tc">
      <div class="mt5 center tc" style="min-width: 700px">
        <div class="f3 ma0">Posts Per Month on StackExchange</div>
        <form class="mv3">
          <select id="lang-select">
            <option value="https://data.stackexchange.com/stackoverflow/csv/966882" selected>C++</option>
            <option value="https://data.stackexchange.com/stackoverflow/csv/966884">Java</option>
            <option value="https://data.stackexchange.com/stackoverflow/csv/966885">Javascript</option>
            <option value="https://data.stackexchange.com/stackoverflow/csv/966880">Lisp</option>
            <option value="https://data.stackexchange.com/stackoverflow/csv/966859">PHP</option>
            <option value="https://data.stackexchange.com/stackoverflow/csv/966857">Python</option>
            <option value="https://data.stackexchange.com/stackoverflow/csv/966858">R</option>
          </select>
        </form>
      </div>
      <div class="mt3 center">
        <svg id="svg" width="800" height="400"></svg>
      </div>
    </div>

    <footer class="fixed z-1 bottom-0 w-100 bg-white tc" style="padding: 18px 16px 16px; box-shadow: inset 0 -20px 60px rgba(0,0,0,0.1), inset 0 1px 4px rgba(0,0,0,0.2)">
      <a href="https://www.flex.io" title="Visit Flex.io website" class="no-underline gray hover-black" target="_blank">
        <span class="relative" style="top: -1px; left: -2px">Powered by</span> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAARCAYAAACBzs+aAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAATpSURBVHjavJd9aNR1HMc/97vzbtvdbrub20zUDe2BprL1tIGjsizBoDAqahQ9l0qFZP9kUhlEEYlh9ARGhBZCmGliRpqu5yiztGZFZqUVs62Nbbene/r1/lzvX3x2nENO1gde3Of3+23f3/fz/P35ZtXVi5Gl4B4wAyTAJ+AZ8BmfXwbKwA6QkQmSbMqV8voSOXd1nfgcEdf979Fs0AR2gp5i1g4Y/THwiLmOgusMnWAXn90FXp4og9XIZF9aUoMZCVUGxE3nLK4B74GpYBtYXMzaDn9jNMKTA1y0l9dHQIN5fp5MoPj8PhnpSklne584IW+LucyKUj+t2LUDZoFq6n+Cy0EXOAdcAPaDi+R/FDX0ly3dUjYtKDUtUcmMZn/F7TawALx4qgYHgZ/6X6Cb+tfkZKSejpoCkuBb8D4Y5fMLQRxofv7GLLKiDm+h7iKtd6UGMsn+w8NS21qhq0Rwvw9s4Tr+vD7iA81coxIMcg/t3M8Yg13iK8Jpk8CjYDmI5D3rAMvAR2AueJ73j4FW/nqiUbuGuvaHHU7QkejppeJmcjWsjXQP93yY63kGq74GLCywP3Xsg+Bdr4YvAatNPU8DL4BXwM0nYbD+3SoaqzvrN1HVrvoOva5rvsT708FzZo07jLEHwQPaqSN1IYnNCUs2mR3v/RdzilhjXaM3sqvf6Rm8Ia/jTeZ4uo31Mp7cC26irmVwLZjJBreZ9yM0Tt+1gmmmchW4n6XwNO+ps27R32wqK/G5YQlWoEsXtjcFqsCrIGyieTUdfQX40Py9OrzV4UxNmAdpjqBB06XzJc3fZebe3ayvv9nVbwRf8tn5YD4YZjS9961iBsR4vRJ8o/HRdK5qjHgjqZBoOi+hw4RR1j6xFXzPqC7g+l7prXAYzUUmDX4Gc9i5V57gZSm+6Cxeq4P+YC01kakmmsI1hU54mLpG6GzqmxmF3MFDazfeiHROFQyvy0Z7pbmndT9QIDBP2vT2mlYiz3P9NGo878ZNZ68FnxdoejY8M4y+joeZeaYclo/phGG/9B4alFhDmWSS7tiV/jUkzPLz5NAJ9voDM1WzKBYo9mxg0lrY9o+ZxmcN1hBVcNx50sIssH3jBrA211iCPuk5kJDu/QMyq61G6hZPzm9caQYkk3cyLCQhM43SxRocYAoP8QSUZpP4CZQYY70s8ZtoV7Fbl9FRuulSpp7O/L05jwZ84sCtRzZ1ScWZpRKbHdbDhz0halb+aMpqIY+e+aJ1XE79qFOkwUE2pz28DnPWqYwQHU2X0rgSkxFrOCpU1rPTe2uuNZvTI+Yk13WjR7f3oFO7tmA8baPZ0308iUle33jcXO90TiGlvQ8Or/5v59fVEzyIvAXe5hl9N//menAr9e/YvHSOv8Z7mubPUteob/eHnM6eg4mlvR1DQ/6gYyvZz0b3pnHYBmbIer77Y858la90/AWKMNLq+zh+NrKG5plG5MkoZ2WTOQOPcDp4Y+8hHiCm0yG66U9zR1Vkdjbptg0fT+6WxnCG48XW7hKWxyKW2nxiZR+b5IA/XlnpFXwzvzE7OE+zBc7KDfyo+IDRFNbRVqZ1hM4Y4UfIXp5wtjHlp3CE6fh53azdz3Go6x8HdeANNrNaHC2fqm6OtpfPLDkDc7maqf8F/1dn+ybwO/uD55A+zuN1/MbXfcs/AgwAy7dkRKrhZTAAAAAASUVORK5CYII=">
      </a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/flexio-sdk-js@latest"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script>
      // sources
      // https://data.stackexchange.com/stackoverflow/query/780988/c-posts-per-month
      // https://data.stackexchange.com/stackoverflow/query/780990/java-posts-per-month
      // https://data.stackexchange.com/stackoverflow/query/780991/javascript-posts-per-month
      // https://data.stackexchange.com/stackoverflow/query/780986/lisp-posts-per-month
      // https://data.stackexchange.com/stackoverflow/query/780965/php-posts-per-month
      // https://data.stackexchange.com/stackoverflow/query/780963/python-posts-per-month
      // https://data.stackexchange.com/stackoverflow/query/780964/r-posts-per-month

      // alt:
      // https://data.stackexchange.com/stackoverflow/query/782028/c-posts-per-day
      // https://data.stackexchange.com/stackoverflow/csv/968099

      var setLoading = function(loading) {
        if (loading === false)
        {
          document.getElementById('top').classList.remove('loading')
        }
         else
        {
          document.getElementById('top').classList.add('loading')
        }
      }

      var renderChart = function(data) {
        d3.select('g').remove()

        var svg = d3.select('#svg')
        var margin = { top: 25, right: 25, bottom: 25, left: 25 }
        var width = svg.attr('width') - margin.left - margin.right
        var height = svg.attr('height') - margin.top - margin.bottom
        var g = svg.append('g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')

        var convertDate = d3.timeParse('%Y-%m-%d %H:%M:%S')

        var x = d3.scaleTime()
          .domain(d3.extent(data, function(d) { return convertDate(d.date) }))
          .rangeRound([0, width])

        var y = d3.scaleLinear()
          .domain(d3.extent(data, function(d) { return +d.count }))
          .rangeRound([height, 0])

        var line = d3.line()
          .x(function(d) { return x(convertDate(d.date)) })
          .y(function(d) { return y(+d.count) })

        g.selectAll('text').data(data)
          .enter().append('path')
          .datum(data)
          .attr('fill', 'none')
          .attr('stroke', 'steelblue')
          .attr('stroke-linejoin', 'round')
          .attr('stroke-linecap', 'round')
          .attr('stroke-width', 2)
          .attr('d', line)

        g.append('g')
          .attr('transform', 'translate(0,' + height + ')')
          .call(d3.axisBottom(x))

        g.append('g')
          .call(d3.axisLeft(y))
      }

      var doSubmit = function(source) {
        setLoading(true)

        Flexio.setup('rryrjgqhvtdttzzsjpjr')
        Flexio.pipe()
          .request(source)
          .convert('csv', 'json')
          .run(function(err, response) {
            renderChart(JSON.parse(response.text))
            setLoading(false)
        })
      }

      var lang_select = document.getElementById('lang-select')
      var source = lang_select.value
      doSubmit(source)

      lang_select.onchange = function(evt) {
        var source = lang_select.value
        doSubmit(source)
      }
    </script>
  </body>
</html>
